# Apache configuration for Ufas1Forms Django application with uvicorn backend
# This configuration sets up Apache as a reverse proxy to the uvicorn server

<VirtualHost *:80>
    ServerName forms.univ-setif.dz
    DocumentRoot /opt/ufas1forms

    # Serve static files directly with Apache (better performance)
    Alias /static /opt/ufas1forms/staticfiles
    <Directory /opt/ufas1forms/staticfiles>
        Require all granted
    </Directory>

    # Serve media files directly with Apache
    Alias /media /opt/ufas1forms/media
    <Directory /opt/ufas1forms/media>
        Require all granted
    </Directory>

    # Proxy all requests to the uvicorn server running on port 8111
    # IMPORTANT: ProxyPass exclusions must come BEFORE the catch-all
    ProxyPreserveHost On
    ProxyPass /static !
    ProxyPass /media !
    ProxyPass / http://127.0.0.1:8111/
    ProxyPassReverse / http://127.0.0.1:8111/

    ErrorLog ${APACHE_LOG_DIR}/ufas1forms_error.log
    CustomLog ${APACHE_LOG_DIR}/ufas1forms_access.log combined
</VirtualHost>

# For HTTPS (recommended for production)
<VirtualHost *:443>
    ServerName forms.univ-setif.dz
    DocumentRoot /opt/ufas1forms

    # SSL Configuration (requires certificates)
    SSLEngine on
    SSLCertificateFile /path/to/your/certificate.crt
    SSLCertificateKeyFile /path/to/your/private.key

    # Serve static files directly with Apache (better performance)
    Alias /static /opt/ufas1forms/staticfiles
    <Directory /opt/ufas1forms/staticfiles>
        Require all granted
    </Directory>

    # Serve media files directly with Apache
    Alias /media /opt/ufas1forms/media
    <Directory /opt/ufas1forms/media>
        Require all granted
    </Directory>

    # Proxy all requests to the uvicorn server running on port 8111
    # IMPORTANT: ProxyPass exclusions must come BEFORE the catch-all
    ProxyPreserveHost On
    ProxyPass /static !
    ProxyPass /media !
    ProxyPass / http://127.0.0.1:8111/
    ProxyPassReverse / http://127.0.0.1:8111/

    ErrorLog ${APACHE_LOG_DIR}/ufas1forms_ssl_error.log
    CustomLog ${APACHE_LOG_DIR}/ufas1forms_ssl_access.log combined
</VirtualHost>
